(function(E,v){typeof exports=="object"&&typeof module!="undefined"?v(exports,require("react"),require("@remix-run/react")):typeof define=="function"&&define.amd?define(["exports","react","@remix-run/react"],v):(E=typeof globalThis!="undefined"?globalThis:E||self,v(E["remix-validated-form"]={},E.React,E.react))})(this,function(E,v,q){"use strict";function kt(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var w=kt(v),Mt=globalThis&&globalThis.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,o=t.length,u;n<o;n++)(u||!(n in t))&&(u||(u=Array.prototype.slice.call(t,0,n)),u[n]=t[n]);return e.concat(u||Array.prototype.slice.call(t))};function R(e,t,r){var n=e.length-t.length,o=Array.from(t);if(n===0)return e.apply(void 0,o);if(n===1){var u=function(s){return e.apply(void 0,Mt([s],o,!1))};return(r||e.lazy)&&(u.lazy=r||e.lazy,u.lazyArgs=t),u}throw new Error("Wrong number of arguments")}function _t(e,t,r){return e.reduce(function(n,o,u){var s=r?t(o,u,e):t(o);return s.hasMany===!0?n.push.apply(n,s.next):s.hasNext===!0&&n.push(s.next),n},[])}var qe=Array.isArray,Re=Object.keys,Ut=Object.prototype.hasOwnProperty;function fe(){return R($t,arguments)}function $t(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var r=qe(e),n=qe(t),o=void 0,u=void 0,s=void 0;if(r&&n){if(u=e.length,u!==t.length)return!1;for(o=u;o--!==0;)if(!fe(e[o],t[o]))return!1;return!0}if(r!==n)return!1;var i=e instanceof Date,a=t instanceof Date;if(i!==a)return!1;if(i&&a)return e.getTime()===t.getTime();var l=e instanceof RegExp,c=t instanceof RegExp;if(l!==c)return!1;if(l&&c)return e.toString()===t.toString();var h=Re(e);if(u=h.length,u!==Re(t).length)return!1;for(o=u;o--!==0;)if(!Ut.call(t,h[o]))return!1;for(o=u;o--!==0;)if(s=h[o],!fe(e[s],t[s]))return!1;return!0}return e!==e&&t!==t}function xt(){return R(Ht,arguments)}function Ht(e,t){var r=new Set(t);return Object.entries(e).reduce(function(n,o){var u=o[0],s=o[1];return r.has(u)||(n[u]=s),n},{})}function Lt(){return R(zt,arguments)}function zt(e,t){return Object.keys(e).reduce(function(r,n){return t(e[n],n)||(r[n]=e[n]),r},{})}function Bt(){return R(qt,arguments)}function qt(e,t,r){for(var n=e,o=0,u=t;o<u.length;o++){var s=u[o];if(n==null||n[s]==null)return r;n=n[s]}return n}function K(){return R(Rt,arguments,K.lazy)}function Rt(e){return _t(e,K.lazy())}(function(e){function t(){var r=new Set;return function(n){return r.has(n)?{done:!1,hasNext:!1}:(r.add(n),{done:!1,hasNext:!0,next:n})}}e.lazy=t})(K||(K={}));const Kt=(e="on",t)=>{if(Array.isArray(t))return t.some(r=>r===!0||r===e);if(typeof t=="boolean")return t;if(typeof t=="string")return t===e},Wt=(e="on",t)=>{if(typeof t=="string")return t===e},Gt={initial:"onBlur",whenTouched:"onChange",whenSubmitted:"onChange"},Jt=({clearError:e,validate:t,defaultValue:r,touched:n,setTouched:o,hasBeenSubmitted:u,validationBehavior:s,name:i})=>{const a={...Gt,...s};return(l={})=>{const c=u?a.whenSubmitted:n?a.whenTouched:a.initial,h={...l,onChange:(...y)=>{var f;return c==="onChange"?t():e(),(f=l==null?void 0:l.onChange)==null?void 0:f.call(l,...y)},onBlur:(...y)=>{var f;return c==="onBlur"&&t(),o(!0),(f=l==null?void 0:l.onBlur)==null?void 0:f.call(l,...y)},name:i};return l.type==="checkbox"?h.defaultChecked=Kt(l.value,r):l.type==="radio"?h.defaultChecked=Wt(l.value,r):l.value===void 0&&(h.defaultValue=r),Lt(h,y=>y===void 0)}},de=e=>{if(e.length===0)return[];const t=e.match(/^\[(.+?)\](.*)$/)||e.match(/^\.?([^\.\[\]]+)(.*)$/);if(t){const[r,n,o]=t;return[/^\d+$/.test(n)?Number(n):n,...de(o)]}return[e]};function H(e,t,r){return Xt(e,de(t),r)}function Xt(e,t,r){var s;const n=t.slice(0,-1),o=t[t.length-1];let u=e;for(let i=0;i<n.length;i++){const a=n[i];if(u[a]===void 0){const l=(s=n[i+1])!=null?s:o;u[a]=typeof l=="number"?[]:{}}u=u[a]}return u[o]=r,e}const M=(e,t)=>Bt(e,de(t),void 0);var Qt=!0,me="Invariant failed";function A(e,t){if(!e){if(Qt)throw new Error(me);var r=typeof t=="function"?t():t,n=r?me+": "+r:me;throw new Error(n)}}const W="__rvfInternalFormId",Zt="__rvfInternalFormDefaults",Ke=e=>`${Zt}_${e}`,We=v.createContext(null),ve=e=>({hydrateTo:()=>e,map:t=>ve(t(e))}),he=()=>({hydrateTo:e=>e,map:()=>he()}),G={serverData:ve,hydratedData:he,from:(e,t)=>t?he():ve(e)},Ge=e=>{let t;const r=new Set,n=(a,l)=>{const c=typeof a=="function"?a(t):a;if(c!==t){const h=t;t=l?c:Object.assign({},t,c),r.forEach(y=>y(t,h))}},o=()=>t,i={setState:n,getState:o,subscribe:a=>(r.add(a),()=>r.delete(a)),destroy:()=>r.clear()};return t=e(n,o,i),i},Yt=e=>e?Ge(e):Ge;var Je={exports:{}},Xe={},Qe={exports:{}},Ze={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L=w.default;function Nt(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var er=typeof Object.is=="function"?Object.is:Nt,tr=L.useState,rr=L.useEffect,nr=L.useLayoutEffect,or=L.useDebugValue;function ur(e,t){var r=t(),n=tr({inst:{value:r,getSnapshot:t}}),o=n[0].inst,u=n[1];return nr(function(){o.value=r,o.getSnapshot=t,ye(o)&&u({inst:o})},[e,r,t]),rr(function(){return ye(o)&&u({inst:o}),e(function(){ye(o)&&u({inst:o})})},[e]),or(r),r}function ye(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!er(e,r)}catch{return!0}}function sr(e,t){return t()}var ir=typeof window=="undefined"||typeof window.document=="undefined"||typeof window.document.createElement=="undefined"?sr:ur;Ze.useSyncExternalStore=L.useSyncExternalStore!==void 0?L.useSyncExternalStore:ir,Qe.exports=Ze;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y=w.default,lr=Qe.exports;function ar(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var cr=typeof Object.is=="function"?Object.is:ar,fr=lr.useSyncExternalStore,dr=Y.useRef,mr=Y.useEffect,vr=Y.useMemo,hr=Y.useDebugValue;Xe.useSyncExternalStoreWithSelector=function(e,t,r,n,o){var u=dr(null);if(u.current===null){var s={hasValue:!1,value:null};u.current=s}else s=u.current;u=vr(function(){function a(f){if(!l){if(l=!0,c=f,f=n(f),o!==void 0&&s.hasValue){var F=s.value;if(o(F,f))return h=F}return h=f}if(F=h,cr(c,f))return F;var p=n(f);return o!==void 0&&o(F,p)?F:(c=f,h=p)}var l=!1,c,h,y=r===void 0?null:r;return[function(){return a(t())},y===null?void 0:function(){return a(y())}]},[t,r,n,o]);var i=fr(e,u[0],u[1]);return mr(function(){s.hasValue=!0,s.value=i},[i]),hr(i),i},Je.exports=Xe;function yr(e,t=e.getState,r){const n=Je.exports.useSyncExternalStoreWithSelector(e.subscribe,e.getState,e.getServerState||e.getState,t,r);return v.useDebugValue(n),n}const Ye=e=>{const t=typeof e=="function"?Yt(e):e,r=(n,o)=>yr(t,n,o);return Object.assign(r,t),r};var pr=e=>e?Ye(e):Ye;function I(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];throw Error("[Immer] minified error nr: "+e+(r.length?" "+r.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function z(e){return!!e&&!!e[V]}function _(e){return!!e&&(function(t){if(!t||typeof t!="object")return!1;var r=Object.getPrototypeOf(t);if(r===null)return!0;var n=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return n===Object||typeof n=="function"&&Function.toString.call(n)===wr}(e)||Array.isArray(e)||!!e[lt]||!!e.constructor[lt]||Fe(e)||be(e))}function J(e,t,r){r===void 0&&(r=!1),B(e)===0?(r?Object.keys:Te)(e).forEach(function(n){r&&typeof n=="symbol"||t(n,e[n],e)}):e.forEach(function(n,o){return t(o,n,e)})}function B(e){var t=e[V];return t?t.i>3?t.i-4:t.i:Array.isArray(e)?1:Fe(e)?2:be(e)?3:0}function pe(e,t){return B(e)===2?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Fr(e,t){return B(e)===2?e.get(t):e[t]}function Ne(e,t,r){var n=B(e);n===2?e.set(t,r):n===3?(e.delete(t),e.add(r)):e[t]=r}function br(e,t){return e===t?e!==0||1/e==1/t:e!=e&&t!=t}function Fe(e){return Vr&&e instanceof Map}function be(e){return Pr&&e instanceof Set}function U(e){return e.o||e.t}function Ee(e){if(Array.isArray(e))return Array.prototype.slice.call(e);var t=Ir(e);delete t[V];for(var r=Te(t),n=0;n<r.length;n++){var o=r[n],u=t[o];u.writable===!1&&(u.writable=!0,u.configurable=!0),(u.get||u.set)&&(t[o]={configurable:!0,writable:!0,enumerable:u.enumerable,value:e[o]})}return Object.create(Object.getPrototypeOf(e),t)}function ge(e,t){return t===void 0&&(t=!1),Se(e)||z(e)||!_(e)||(B(e)>1&&(e.set=e.add=e.clear=e.delete=Er),Object.freeze(e),t&&J(e,function(r,n){return ge(n,!0)},!0)),e}function Er(){I(2)}function Se(e){return e==null||typeof e!="object"||Object.isFrozen(e)}function D(e){var t=Dr[e];return t||I(18,e),t}function et(){return X}function Ve(e,t){t&&(D("Patches"),e.u=[],e.s=[],e.v=t)}function N(e){Pe(e),e.p.forEach(gr),e.p=null}function Pe(e){e===X&&(X=e.l)}function tt(e){return X={p:[],l:X,h:e,m:!0,_:0}}function gr(e){var t=e[V];t.i===0||t.i===1?t.j():t.O=!0}function we(e,t){t._=t.p.length;var r=t.p[0],n=e!==void 0&&e!==r;return t.h.g||D("ES5").S(t,e,n),n?(r[V].P&&(N(t),I(4)),_(e)&&(e=ee(t,e),t.l||te(t,e)),t.u&&D("Patches").M(r[V].t,e,t.u,t.s)):e=ee(t,r,[]),N(t),t.u&&t.v(t.u,t.s),e!==it?e:void 0}function ee(e,t,r){if(Se(t))return t;var n=t[V];if(!n)return J(t,function(u,s){return rt(e,n,t,u,s,r)},!0),t;if(n.A!==e)return t;if(!n.P)return te(e,n.t,!0),n.t;if(!n.I){n.I=!0,n.A._--;var o=n.i===4||n.i===5?n.o=Ee(n.k):n.o;J(n.i===3?new Set(o):o,function(u,s){return rt(e,n,o,u,s,r)}),te(e,o,!1),r&&e.u&&D("Patches").R(n,r,e.u,e.s)}return n.o}function rt(e,t,r,n,o,u){if(z(o)){var s=ee(e,o,u&&t&&t.i!==3&&!pe(t.D,n)?u.concat(n):void 0);if(Ne(r,n,s),!z(s))return;e.m=!1}if(_(o)&&!Se(o)){if(!e.h.F&&e._<1)return;ee(e,o),t&&t.A.l||te(e,o)}}function te(e,t,r){r===void 0&&(r=!1),e.h.F&&e.m&&ge(t,r)}function Ie(e,t){var r=e[V];return(r?U(r):e)[t]}function nt(e,t){if(t in e)for(var r=Object.getPrototypeOf(e);r;){var n=Object.getOwnPropertyDescriptor(r,t);if(n)return n;r=Object.getPrototypeOf(r)}}function De(e){e.P||(e.P=!0,e.l&&De(e.l))}function Oe(e){e.o||(e.o=Ee(e.t))}function Ce(e,t,r){var n=Fe(t)?D("MapSet").N(t,r):be(t)?D("MapSet").T(t,r):e.g?function(o,u){var s=Array.isArray(o),i={i:s?1:0,A:u?u.A:et(),P:!1,I:!1,D:{},l:u,t:o,k:null,o:null,j:null,C:!1},a=i,l=je;s&&(a=[i],l=Q);var c=Proxy.revocable(a,l),h=c.revoke,y=c.proxy;return i.k=y,i.j=h,y}(t,r):D("ES5").J(t,r);return(r?r.A:et()).p.push(n),n}function Sr(e){return z(e)||I(22,e),function t(r){if(!_(r))return r;var n,o=r[V],u=B(r);if(o){if(!o.P&&(o.i<4||!D("ES5").K(o)))return o.t;o.I=!0,n=ot(r,u),o.I=!1}else n=ot(r,u);return J(n,function(s,i){o&&Fr(o.t,s)===i||Ne(n,s,t(i))}),u===3?new Set(n):n}(e)}function ot(e,t){switch(t){case 2:return new Map(e);case 3:return Array.from(e)}return Ee(e)}var ut,X,Ae=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",Vr=typeof Map!="undefined",Pr=typeof Set!="undefined",st=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",it=Ae?Symbol.for("immer-nothing"):((ut={})["immer-nothing"]=!0,ut),lt=Ae?Symbol.for("immer-draftable"):"__$immer_draftable",V=Ae?Symbol.for("immer-state"):"__$immer_state",wr=""+Object.prototype.constructor,Te=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames,Ir=Object.getOwnPropertyDescriptors||function(e){var t={};return Te(e).forEach(function(r){t[r]=Object.getOwnPropertyDescriptor(e,r)}),t},Dr={},je={get:function(e,t){if(t===V)return e;var r=U(e);if(!pe(r,t))return function(o,u,s){var i,a=nt(u,s);return a?"value"in a?a.value:(i=a.get)===null||i===void 0?void 0:i.call(o.k):void 0}(e,r,t);var n=r[t];return e.I||!_(n)?n:n===Ie(e.t,t)?(Oe(e),e.o[t]=Ce(e.A.h,n,e)):n},has:function(e,t){return t in U(e)},ownKeys:function(e){return Reflect.ownKeys(U(e))},set:function(e,t,r){var n=nt(U(e),t);if(n!=null&&n.set)return n.set.call(e.k,r),!0;if(!e.P){var o=Ie(U(e),t),u=o==null?void 0:o[V];if(u&&u.t===r)return e.o[t]=r,e.D[t]=!1,!0;if(br(r,o)&&(r!==void 0||pe(e.t,t)))return!0;Oe(e),De(e)}return e.o[t]===r&&typeof r!="number"&&(r!==void 0||t in e.o)||(e.o[t]=r,e.D[t]=!0,!0)},deleteProperty:function(e,t){return Ie(e.t,t)!==void 0||t in e.t?(e.D[t]=!1,Oe(e),De(e)):delete e.D[t],e.o&&delete e.o[t],!0},getOwnPropertyDescriptor:function(e,t){var r=U(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n&&{writable:!0,configurable:e.i!==1||t!=="length",enumerable:n.enumerable,value:r[t]}},defineProperty:function(){I(11)},getPrototypeOf:function(e){return Object.getPrototypeOf(e.t)},setPrototypeOf:function(){I(12)}},Q={};J(je,function(e,t){Q[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Q.deleteProperty=function(e,t){return Q.set.call(this,e,t,void 0)},Q.set=function(e,t,r){return je.set.call(this,e[0],t,r,e[0])};var Or=function(){function e(r){var n=this;this.g=st,this.F=!0,this.produce=function(o,u,s){if(typeof o=="function"&&typeof u!="function"){var i=u;u=o;var a=n;return function(p){var T=this;p===void 0&&(p=i);for(var j=arguments.length,C=Array(j>1?j-1:0),$=1;$<j;$++)C[$-1]=arguments[$];return a.produce(p,function(ze){var x;return(x=u).call.apply(x,[T,ze].concat(C))})}}var l;if(typeof u!="function"&&I(6),s!==void 0&&typeof s!="function"&&I(7),_(o)){var c=tt(n),h=Ce(n,o,void 0),y=!0;try{l=u(h),y=!1}finally{y?N(c):Pe(c)}return typeof Promise!="undefined"&&l instanceof Promise?l.then(function(p){return Ve(c,s),we(p,c)},function(p){throw N(c),p}):(Ve(c,s),we(l,c))}if(!o||typeof o!="object"){if((l=u(o))===void 0&&(l=o),l===it&&(l=void 0),n.F&&ge(l,!0),s){var f=[],F=[];D("Patches").M(o,l,f,F),s(f,F)}return l}I(21,o)},this.produceWithPatches=function(o,u){if(typeof o=="function")return function(l){for(var c=arguments.length,h=Array(c>1?c-1:0),y=1;y<c;y++)h[y-1]=arguments[y];return n.produceWithPatches(l,function(f){return o.apply(void 0,[f].concat(h))})};var s,i,a=n.produce(o,u,function(l,c){s=l,i=c});return typeof Promise!="undefined"&&a instanceof Promise?a.then(function(l){return[l,s,i]}):[a,s,i]},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var t=e.prototype;return t.createDraft=function(r){_(r)||I(8),z(r)&&(r=Sr(r));var n=tt(this),o=Ce(this,r,void 0);return o[V].C=!0,Pe(n),o},t.finishDraft=function(r,n){var o=r&&r[V],u=o.A;return Ve(u,n),we(void 0,u)},t.setAutoFreeze=function(r){this.F=r},t.setUseProxies=function(r){r&&!st&&I(20),this.g=r},t.applyPatches=function(r,n){var o;for(o=n.length-1;o>=0;o--){var u=n[o];if(u.path.length===0&&u.op==="replace"){r=u.value;break}}o>-1&&(n=n.slice(o+1));var s=D("Patches").$;return z(r)?s(r,n):this.produce(r,function(i){return s(i,n)})},e}(),P=new Or,Cr=P.produce;P.produceWithPatches.bind(P),P.setAutoFreeze.bind(P),P.setUseProxies.bind(P),P.applyPatches.bind(P),P.createDraft.bind(P),P.finishDraft.bind(P);const Ar=e=>(t,r,n)=>(n.setState=(o,u,...s)=>{const i=typeof o=="function"?Cr(o):o;return t(i,u,...s)},e(n.setState,r,n)),Tr=(e,t)=>{if(typeof Object.getPrototypeOf(e).requestSubmit=="function"){e.requestSubmit(t);return}if(t){jr(e,t),t.click();return}const r=document.createElement("input");r.type="submit",r.hidden=!0,e.appendChild(r),r.click(),e.removeChild(r)};function jr(e,t){t instanceof HTMLElement||ke(TypeError,"parameter 1 is not of type 'HTMLElement'"),"type"in t&&t.type==="submit"||ke(TypeError,"The specified element is not a submit button"),"form"in t&&t.form===e||ke(DOMException,"The specified element is not owned by this form element","NotFoundError")}function ke(e,t,r){throw new e("Failed to execute 'requestSubmit' on 'HTMLFormElement': "+t+".",r)}const g=(e,t)=>{const r=M(e,t);if(r==null){const n=[];return H(e,t,n),n}return A(Array.isArray(r),`FieldArray: defaultValue value for ${t} must be an array, null, or undefined`),r},re=(e,t,r)=>{const n=e[t],o=e[r],u=t in e,s=r in e;u?e[r]=n:delete e[r],s?e[t]=o:delete e[t]};function Z(e,t,r,n){return e.length<t&&n&&(e.length=t),arguments.length===4?e.splice(t,r,n):e.splice(t,r)}const ne=(e,t,r)=>{const[n]=Z(e,t,1);Z(e,r,0,n)},oe=(e,t,r)=>{Z(e,t,0,r)},ue=(e,t)=>{Z(e,t,1)},se=(e,t,r)=>{Z(e,t,1,r)},S=(e,t,r)=>{const n=new Set,o=[];for(const[s,i]of Object.entries(t))s.startsWith(e)&&s!==e&&(n.add(s),H(o,s.substring(e.length),i));r(o);for(const s of n)delete t[s];const u=Me(o);for(const s of u){const i=M(o,s);i!==void 0&&(t[`${e}${s}`]=i)}},Me=(e,t="")=>Array.isArray(e)?e.flatMap((r,n)=>Me(r,`${t}[${n}]`)):typeof e=="object"?Object.keys(e).flatMap(r=>Me(e[r],`${t}.${r}`)):[t],b=()=>{},kr={isHydrated:!1,isSubmitting:!1,hasBeenSubmitted:!1,touchedFields:{},fieldErrors:{},formElement:null,isValid:()=>!0,startSubmit:b,endSubmit:b,setTouched:b,setFieldError:b,setFieldErrors:b,clearFieldError:b,currentDefaultValues:{},reset:()=>b,syncFormProps:b,setFormElement:b,validateField:async()=>null,validate:async()=>{throw new Error("Validate called before form was initialized.")},submit:async()=>{throw new Error("Submit called before form was initialized.")},resetFormElement:b,getValues:()=>new FormData,controlledFields:{values:{},refCounts:{},valueUpdatePromises:{},valueUpdateResolvers:{},register:b,unregister:b,setValue:b,getValue:b,kickoffValueUpdate:b,awaitValueUpdate:async()=>{throw new Error("AwaitValueUpdate called before form was initialized.")},array:{push:b,swap:b,move:b,insert:b,unshift:b,remove:b,pop:b,replace:b}}},Mr=(e,t)=>({isHydrated:!1,isSubmitting:!1,hasBeenSubmitted:!1,touchedFields:{},fieldErrors:{},formElement:null,currentDefaultValues:{},isValid:()=>Object.keys(t().fieldErrors).length===0,startSubmit:()=>e(r=>{r.isSubmitting=!0,r.hasBeenSubmitted=!0}),endSubmit:()=>e(r=>{r.isSubmitting=!1}),setTouched:(r,n)=>e(o=>{o.touchedFields[r]=n}),setFieldError:(r,n)=>e(o=>{o.fieldErrors[r]=n}),setFieldErrors:r=>e(n=>{n.fieldErrors=r}),clearFieldError:r=>e(n=>{delete n.fieldErrors[r]}),reset:()=>e(r=>{var o,u;r.fieldErrors={},r.touchedFields={},r.hasBeenSubmitted=!1;const n=(u=(o=r.formProps)==null?void 0:o.defaultValues)!=null?u:{};r.controlledFields.values=n,r.currentDefaultValues=n}),syncFormProps:r=>e(n=>{n.isHydrated||(n.controlledFields.values=r.defaultValues,n.currentDefaultValues=r.defaultValues),n.formProps=r,n.isHydrated=!0}),setFormElement:r=>{t().formElement!==r&&e(n=>{n.formElement=r})},validateField:async r=>{var s,i,a;const n=t().formElement;A(n,"Cannot find reference to form. This is probably a bug in remix-validated-form.");const o=(s=t().formProps)==null?void 0:s.validator;A(o,"Cannot validator. This is probably a bug in remix-validated-form."),await((a=(i=t().controlledFields).awaitValueUpdate)==null?void 0:a.call(i,r));const{error:u}=await o.validateField(new FormData(n),r);return u?(t().setFieldError(r,u),u):(t().clearFieldError(r),null)},validate:async()=>{var u;const r=t().formElement;A(r,"Cannot find reference to form. This is probably a bug in remix-validated-form.");const n=(u=t().formProps)==null?void 0:u.validator;A(n,"Cannot validator. This is probably a bug in remix-validated-form.");const o=await n.validate(new FormData(r));return o.error&&t().setFieldErrors(o.error.fieldErrors),o},submit:()=>{const r=t().formElement;A(r,"Cannot find reference to form. This is probably a bug in remix-validated-form."),Tr(r)},getValues:()=>{var r;return new FormData((r=t().formElement)!=null?r:void 0)},resetFormElement:()=>{var r;return(r=t().formElement)==null?void 0:r.reset()},controlledFields:{values:{},refCounts:{},valueUpdatePromises:{},valueUpdateResolvers:{},register:r=>{e(n=>{var u;const o=(u=n.controlledFields.refCounts[r])!=null?u:0;n.controlledFields.refCounts[r]=o+1})},unregister:r=>{t()===null||t()===void 0||e(n=>{var s,i,a;const o=(s=n.controlledFields.refCounts[r])!=null?s:0;if(o>1){n.controlledFields.refCounts[r]=o-1;return}Object.keys(n.controlledFields.refCounts).some(l=>r.startsWith(l)&&l!==r)||(H(n.controlledFields.values,r,M((i=n.formProps)==null?void 0:i.defaultValues,r)),H(n.currentDefaultValues,r,M((a=n.formProps)==null?void 0:a.defaultValues,r))),delete n.controlledFields.refCounts[r]})},getValue:r=>M(t().controlledFields.values,r),setValue:(r,n)=>{e(o=>{H(o.controlledFields.values,r,n)}),t().controlledFields.kickoffValueUpdate(r)},kickoffValueUpdate:r=>{const n=()=>e(o=>{delete o.controlledFields.valueUpdateResolvers[r],delete o.controlledFields.valueUpdatePromises[r]});e(o=>{const u=new Promise(s=>{o.controlledFields.valueUpdateResolvers[r]=s}).then(n);o.controlledFields.valueUpdatePromises[r]=u})},awaitValueUpdate:async r=>{await t().controlledFields.valueUpdatePromises[r]},array:{push:(r,n)=>{e(o=>{g(o.controlledFields.values,r).push(n),g(o.currentDefaultValues,r).push(n)}),t().controlledFields.kickoffValueUpdate(r)},swap:(r,n,o)=>{e(u=>{re(g(u.controlledFields.values,r),n,o),re(g(u.currentDefaultValues,r),n,o),S(r,u.touchedFields,s=>re(s,n,o)),S(r,u.fieldErrors,s=>re(s,n,o))}),t().controlledFields.kickoffValueUpdate(r)},move:(r,n,o)=>{e(u=>{ne(g(u.controlledFields.values,r),n,o),ne(g(u.currentDefaultValues,r),n,o),S(r,u.touchedFields,s=>ne(s,n,o)),S(r,u.fieldErrors,s=>ne(s,n,o))}),t().controlledFields.kickoffValueUpdate(r)},insert:(r,n,o)=>{e(u=>{oe(g(u.controlledFields.values,r),n,o),oe(g(u.currentDefaultValues,r),n,o),S(r,u.touchedFields,s=>oe(s,n,!1)),S(r,u.fieldErrors,s=>oe(s,n,void 0))}),t().controlledFields.kickoffValueUpdate(r)},remove:(r,n)=>{e(o=>{ue(g(o.controlledFields.values,r),n),ue(g(o.currentDefaultValues,r),n),S(r,o.touchedFields,u=>ue(u,n)),S(r,o.fieldErrors,u=>ue(u,n))}),t().controlledFields.kickoffValueUpdate(r)},pop:r=>{e(n=>{g(n.controlledFields.values,r).pop(),g(n.currentDefaultValues,r).pop(),S(r,n.touchedFields,o=>o.pop()),S(r,n.fieldErrors,o=>o.pop())}),t().controlledFields.kickoffValueUpdate(r)},unshift:(r,n)=>{e(o=>{g(o.controlledFields.values,r).unshift(n),g(o.currentDefaultValues,r).unshift(n),S(r,o.touchedFields,u=>u.unshift(!1)),S(r,o.fieldErrors,u=>u.unshift(void 0))})},replace:(r,n,o)=>{e(u=>{se(g(u.controlledFields.values,r),n,o),se(g(u.currentDefaultValues,r),n,o),S(r,u.touchedFields,s=>se(s,n,o)),S(r,u.fieldErrors,s=>se(s,n,o))}),t().controlledFields.kickoffValueUpdate(r)}}}}),_e=pr()(Ar((e,t)=>({forms:{},form:r=>{var n;return(n=t().forms[r])!=null?n:kr},cleanupForm:r=>{e(n=>{delete n.forms[r]})},registerForm:r=>{t().forms[r]||e(n=>{n.forms[r]=Mr(o=>e(u=>o(u.forms[r])),()=>t().forms[r])})}}))),d=(e,t)=>_e(r=>t(r.form(e))),O=(e,t)=>{const r=v.useContext(We);if(e)return{formId:e};if(r)return r;throw new Error(`Unable to determine form for ${t}. Please use it inside a ValidatedForm or pass a 'formId'.`)};function Ue({fetcher:e,subaction:t,formId:r}){var o;const n=q.useActionData();return e?(o=e.data)!=null&&o.fieldErrors?e.data:null:n!=null&&n.fieldErrors?typeof r=="string"&&n.formId?n.formId===r?n:null:!t&&!n.subaction||n.subaction===t?n:null:null}const at=e=>{const t=Ue(e),r=d(e.formId,n=>n.isHydrated);return G.from(t==null?void 0:t.fieldErrors,r)},ct=({formId:e})=>{const t=q.useMatches();if(typeof e=="string"){const r=Ke(e),n=t.reverse().find(o=>o.data&&r in o.data);return n==null?void 0:n.data[r]}return null},ft=e=>{const{formId:t,defaultValuesProp:r}=e,n=d(t,s=>s.isHydrated),o=Ue(e),u=ct(e);return n?G.hydratedData():o!=null&&o.repopulateFields?(A(typeof o.repopulateFields=="object","repopulateFields returned something other than an object"),G.serverData(o.repopulateFields)):r?G.serverData(r):G.serverData(u)},_r=({fetcher:e})=>{const t=q.useTransition();return e?e.state==="submitting":!!t.submission},Ur=(e,{formId:t})=>{const r=d(t,u=>u.touchedFields[e]),n=d(t,u=>u.setTouched),o=v.useCallback(u=>n(e,u),[e,n]);return[r,o]},dt=(e,t)=>{const r=at(t),n=d(t.formId,o=>o.fieldErrors[e]);return r.map(o=>o==null?void 0:o[e]).hydrateTo(n)},mt=e=>{const{formId:t}=e;return d(t,r=>r.clearFieldError)},$r=(e,t)=>d(e,r=>M(r.currentDefaultValues,t)),$e=(e,t)=>{const r=ft(t),n=$r(t.formId,e);return r.map(o=>M(o,e)).hydrateTo(n)},vt=e=>d(e,t=>t.isSubmitting),ht=e=>d(e,t=>t.isValid()),xe=e=>d(e,t=>t.hasBeenSubmitted),He=e=>d(e,t=>t.validateField),xr=e=>d(e,t=>t.validate),Hr=()=>()=>{},yt=e=>d(e,t=>{var r,n;return(n=(r=t.formProps)==null?void 0:r.registerReceiveFocus)!=null?n:Hr}),Lr={},zr=e=>d(e,t=>{var r,n;return(n=(r=t.formProps)==null?void 0:r.defaultValues)!=null?n:Lr}),Br=({formId:e})=>d(e,t=>t.setTouched),qr=e=>d(e,t=>t.touchedFields),Rr=e=>d(e,t=>t.fieldErrors),pt=e=>d(e,t=>t.setFieldErrors),Kr=e=>d(e,t=>t.resetFormElement),Wr=e=>d(e,t=>t.submit),Gr=e=>d(e,t=>{var r;return(r=t.formProps)==null?void 0:r.action}),Jr=e=>d(e,t=>{var r;return(r=t.formProps)==null?void 0:r.subaction}),Xr=e=>d(e,t=>t.getValues),Qr=(e,t)=>{const r=d(e.formId,u=>u.controlledFields.getValue(t)),n=d(e.formId,u=>u.isHydrated),o=$e(t,e);return n?r:o},Ft=(e,t)=>{const r=d(e.formId,u=>u.controlledFields.valueUpdateResolvers[t]);v.useEffect(()=>{r==null||r()},[r]);const n=d(e.formId,u=>u.controlledFields.register),o=d(e.formId,u=>u.controlledFields.unregister);v.useEffect(()=>(n(t),()=>o(t)),[e.formId,t,n,o])},Zr=(e,t)=>{Ft(e,t);const r=d(e.formId,u=>u.controlledFields.setValue),n=v.useCallback(u=>r(t,u),[t,r]);return[Qr(e,t),n]},Yr=e=>{const t=d(e,r=>r.controlledFields.setValue);return v.useCallback((r,n)=>t(r,n),[t])},bt=e=>{const t=O(e,"useIsSubmitting");return vt(t.formId)},Et=e=>{const t=O(e,"useIsValid");return ht(t.formId)},Nr=(e,t)=>{const{formId:r,handleReceiveFocus:n}=t!=null?t:{},o=O(r,"useField"),u=$e(e,o),[s,i]=Ur(e,o),a=dt(e,o),l=mt(o),c=xe(o.formId),h=He(o.formId),y=yt(o.formId);return v.useEffect(()=>{if(n)return y(e,n)},[n,e,y]),v.useMemo(()=>{const F={error:a,clearError:()=>l(e),validate:()=>{h(e)},defaultValue:u,touched:s,setTouched:i},p=Jt({...F,name:e,hasBeenSubmitted:c,validationBehavior:t==null?void 0:t.validationBehavior});return{...F,getInputProps:p}},[a,l,u,s,i,e,c,t==null?void 0:t.validationBehavior,h])},en=(e,t)=>{const r=O(t,"useControlField"),[n,o]=Zr(r,e);return[n,o]},tn=e=>{const t=O(e,"useControlField");return Yr(t.formId)};/**
 * @remix-run/server-runtime v1.6.5
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const rn=(e,t={})=>{let r=typeof t=="number"?{status:t}:t,n=new Headers(r.headers);return n.has("Content-Type")||n.set("Content-Type","application/json; charset=utf-8"),new Response(JSON.stringify(e),{...r,headers:n})};function nn(e,t,r){return rn({fieldErrors:e.fieldErrors,subaction:e.subaction,repopulateFields:t,formId:e.formId},{status:422,...r})}const on=(e,t)=>({[Ke(e)]:t});class gt{constructor(){this.dict=new Map,this.add=(t,r)=>{this.dict.has(t)?this.dict.get(t).push(r):this.dict.set(t,[r])},this.delete=t=>{this.dict.delete(t)},this.remove=(t,r)=>{if(!this.dict.has(t))return;const n=this.dict.get(t),o=n.indexOf(r);o!==-1&&n.splice(o,1),n.length===0&&this.dict.delete(t)},this.getAll=t=>{var r;return(r=this.dict.get(t))!=null?r:[]},this.entries=()=>this.dict.entries(),this.values=()=>this.dict.values(),this.has=t=>this.dict.has(t)}}const un=()=>{const e=v.useRef(null);return v.useCallback(()=>(e.current||(e.current=new gt),e.current),[])};function St(e,t){const r=v.useRef(!1);v.useEffect(()=>{e&&(r.current=!0),!e&&r.current&&(r.current=!1,t())})}const sn=e=>t=>{e.filter(Boolean).forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})},Le=typeof window!="undefined"?v.useLayoutEffect:v.useEffect,ln=e=>{const t=v.useRef(e),r=t.current===e||fe(t.current,e);return v.useEffect(()=>{r||(t.current=e)}),r?t.current:e},an=e=>new FormData(e);function cn(e){return e!==null}const fn=(e,t,r)=>{var u;const n=[...r.elements].map(s=>{const i=s instanceof RadioNodeList?s[0]:s;return i instanceof HTMLElement&&"name"in i?i.name:null}).filter(cn).filter(s=>s in e),o=K(n);for(const s of o){if(t.has(s)){t.getAll(s).forEach(a=>{a()});break}const i=r.elements.namedItem(s);if(!!i){if(i instanceof RadioNodeList){const a=(u=[...i].filter(l=>l instanceof HTMLInputElement).find(l=>l.value===i.value))!=null?u:i[0];if(a&&a instanceof HTMLInputElement){a.focus();break}}if(i instanceof HTMLElement){if(i instanceof HTMLInputElement&&i.type==="hidden")continue;i.focus();break}}}},dn=e=>{const[t]=v.useState(()=>Symbol("remix-validated-form-id"));return e!=null?e:t},mn=({resetAfterSubmit:e,formRef:t})=>{const r=bt(),n=Et();return St(r,()=>{var o;n&&e&&((o=t.current)==null||o.reset())}),null};function vn(e){let t=!1;return new Proxy(e,{get:(r,n)=>n==="preventDefault"?()=>{t=!0}:n==="defaultPrevented"?t:r[n]})}function hn({validator:e,onSubmit:t,children:r,fetcher:n,action:o,defaultValues:u,formRef:s,onReset:i,subaction:a,resetAfterSubmit:l=!1,disableFocusOnError:c,method:h,replace:y,id:f,...F}){var Tt;const p=dn(f),T=ln(u),j=v.useMemo(()=>({formId:p,action:o,subaction:a,defaultValuesProp:T,fetcher:n}),[o,n,p,T,a]),C=Ue(j),$=ct(j),ze=_r(j),x=v.useRef(null),Vn=(Tt=n==null?void 0:n.Form)!=null?Tt:q.Form,Pn=q.useSubmit(),ie=pt(p),wn=d(p,m=>m.setFieldError),In=d(p,m=>m.reset),Dn=d(p,m=>m.startSubmit),le=d(p,m=>m.endSubmit),It=d(p,m=>m.syncFormProps),Dt=d(p,m=>m.setFormElement),Ot=_e(m=>m.cleanupForm),Ct=_e(m=>m.registerForm),ae=un(),At=v.useCallback((m,ce)=>(ae().add(m,ce),()=>{ae().remove(m,ce)}),[ae]);Le(()=>(Ct(p),()=>Ot(p)),[Ot,p,Ct]),Le(()=>{var m;It({action:o,defaultValues:(m=T!=null?T:$)!=null?m:{},subaction:a,registerReceiveFocus:At,validator:e})},[o,T,At,a,It,$,e]),Le(()=>{Dt(x.current)},[Dt]),v.useEffect(()=>{var m;ie((m=C==null?void 0:C.fieldErrors)!=null?m:{})},[C==null?void 0:C.fieldErrors,ie,wn]),St(ze,()=>{le()});const On=async(m,ce,Cn)=>{Dn();const Be=await e.validate(an(m.currentTarget)),k=Cn.submitter;if(!(k!=null&&k.formNoValidate)&&Be.error)le(),ie(Be.error.fieldErrors),le(),c||fn(Be.error.fieldErrors,ae(),x.current);else{ie({});const jt=vn(m);if(await(t==null?void 0:t(jt)),jt.defaultPrevented){le();return}n?n.submit(k||m.currentTarget):Pn(k||ce,{replace:y,method:(k==null?void 0:k.formMethod)||h})}};return w.default.createElement(Vn,{ref:sn([x,s]),...F,id:f,action:o,method:h,replace:y,onSubmit:m=>{m.preventDefault(),On(m,m.currentTarget,m.nativeEvent)},onReset:m=>{i==null||i(m),!m.defaultPrevented&&In()}},w.default.createElement(We.Provider,{value:j},w.default.createElement(w.default.Fragment,null,w.default.createElement(mn,{formRef:x,resetAfterSubmit:l}),a&&w.default.createElement("input",{type:"hidden",value:a,name:"subaction"}),f&&w.default.createElement("input",{type:"hidden",value:f,name:W}),r)))}const Vt=e=>{const t=new gt;return e.forEach(([r,n])=>t.add(r,n)),[...t.entries()].reduce((r,[n,o])=>H(r,n,o.length===1?o[0]:o),{})},Pt=e=>"entries"in e&&typeof e.entries=="function"?Vt([...e.entries()]):Vt(Object.entries(e)),yn=e=>xt(e,[W]);function pn(e){return{validate:async t=>{const r=Pt(t),n=await e.validate(yn(r));return n.error?{data:void 0,error:{fieldErrors:n.error,subaction:r.subaction,formId:r[W]},submittedData:r,formId:r[W]}:{data:n.data,error:void 0,submittedData:r,formId:r[W]}},validateField:(t,r)=>e.validateField(Pt(t),r)}}const Fn=e=>{const t=O(e,"useFormState"),r=vt(t.formId),n=xe(t.formId),o=qr(t.formId),u=ht(t.formId),s=Gr(t.formId),i=Jr(t.formId),a=zr(t.formId),c=ft(t).hydrateTo(a),h=Rr(t.formId),f=at(t).hydrateTo(h);return v.useMemo(()=>({action:s,subaction:i,defaultValues:c,fieldErrors:f!=null?f:{},hasBeenSubmitted:n,isSubmitting:r,touchedFields:o,isValid:u}),[s,n,c,f,r,u,i,o])},bn=e=>{const t=O(e,"useFormHelpers"),r=Br(t),n=He(t.formId),o=xr(t.formId),u=mt(t),s=pt(t.formId),i=Kr(t.formId),a=Wr(t.formId),l=Xr(t.formId);return v.useMemo(()=>({setTouched:r,validateField:n,clearError:u,validate:o,clearAllErrors:()=>s({}),reset:i,submit:a,getValues:l}),[u,i,s,r,a,o,n,l])},En=e=>{const t=O(e,"useFormContext"),r=Fn(e),{clearError:n,setTouched:o,validateField:u,clearAllErrors:s,validate:i,reset:a,submit:l,getValues:c}=bn(e),h=yt(t.formId),y=v.useCallback((...f)=>{f.forEach(F=>{n(F)})},[n]);return v.useMemo(()=>({...r,setFieldTouched:o,validateField:u,clearError:y,registerReceiveFocus:h,clearAllErrors:s,validate:i,reset:a,submit:l,getValues:c}),[s,y,h,a,o,r,l,i,u,c])},wt=(e,t,r)=>{const n=$e(t,e);Ft(e,t);const o=xe(e.formId),u=He(e.formId),s=dt(t,e),i={initial:"onSubmit",whenSubmitted:"onChange",...r},a=o?i.whenSubmitted:i.initial,l=v.useCallback(()=>{a==="onChange"&&u(t)},[a,t,u]);A(n==null||Array.isArray(n),`FieldArray: defaultValue value for ${t} must be an array, null, or undefined`);const c=d(e.formId,f=>f.controlledFields.array),h=v.useMemo(()=>({push:f=>{c.push(t,f),l()},swap:(f,F)=>{c.swap(t,f,F),l()},move:(f,F)=>{c.move(t,f,F),l()},insert:(f,F)=>{c.insert(t,f,F),l()},unshift:f=>{c.unshift(t,f),l()},remove:f=>{c.remove(t,f),l()},pop:()=>{c.pop(t),l()},replace:(f,F)=>{c.replace(t,f,F),l()}}),[c,t,l]);return[v.useMemo(()=>n!=null?n:[],[n]),h,s]};function gn(e,{formId:t,validationBehavior:r}={}){const n=O(t,"FieldArray");return wt(n,e,r)}const Sn=({name:e,children:t,formId:r,validationBehavior:n})=>{const o=O(r,"FieldArray"),[u,s,i]=wt(o,e,n);return w.default.createElement(w.default.Fragment,null,t(u,s,i))};E.FieldArray=Sn,E.ValidatedForm=hn,E.createValidator=pn,E.setFormDefaults=on,E.useControlField=en,E.useField=Nr,E.useFieldArray=gn,E.useFormContext=En,E.useIsSubmitting=bt,E.useIsValid=Et,E.useUpdateControlledField=tn,E.validationError=nn,Object.defineProperties(E,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=remix-validated-form.umd.js.map
